ドライバ流れまとめ

ドライバは最初にカーネルにロードすることにより、その機能を使うことができる

ロードするときは、カーネルに静的リンクをして、ロードを行っている。

ドライバがロードを完了するために、最初にエントリポイントを見る必要がある。
エントリポイントはmodule_initで指定された関数がエントリポイントとなる。
他にもエントリポイントになるものがある
・システムコール
・割り込み
・タイマ


ユーザープロセス(C言語やコマンド)などを実行する
↓
この段階で、システムコールでreadやらwriteやらが呼ばれる
↓
readやwriteなどの処理は、デバイスドライバにかかれている。なので、デバイスドライバにアクセスして処理を行うためにデバイスファイルに命令を行う。

ex)
echo "A" > /dev/devone

これはユーザーがデバイスファイルにAを書いてくださいと命令している。(writeシステムコールを行うよう命令している)
↓
これにより、デバイスファイルで設定されているデバイスドライバのメジャー番号のデバイスドライバにアクセスする
↓
そのデバイスドライバに書いてあるシステムコールが呼ばれたときに、行われる処理が行われる(devone.c)

cf)

[ 7265.798736] devone_open:major 234 minor 1 (pid 1156)¥n
[ 7265.798819] devone_write: count 2 pos 0¥n
[ 7265.798847] devone_close:major 234 minor 1 (pid 1156)¥n




ーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーー
カーネルのデバイスファイルについて

デバイスファイルは、ユーザープロセスがカーネル内のデバイスドライバにアクセスできるようにするためのファイル

ユーザープロセスはこのファイルを扱うためにシステムコールを用いる
実際にデバイスファイルに対して行われた動作がデバイスドライバにも同様に動作する
ex)デバイスファイルを開く
これは、デバイスドライバに開くようにアクセスしている